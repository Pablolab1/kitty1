{"ast":null,"code":"\"use strict\";\n/**\n * @license\n * Copyright Akveo. All Rights Reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n */\n\nvar _toConsumableArray = require(\"@babel/runtime/helpers/toConsumableArray\");\n\nvar _extends = require(\"@babel/runtime/helpers/extends\");\n\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar date_service_1 = require(\"./date.service\");\n\nvar helpers_1 = require(\"./helpers\");\n\nvar type_1 = require(\"../type\");\n\nvar DEFAULT_DATE_OPTIONS = {\n  bounding: false,\n  holiday: false,\n  range: type_1.RangeRole.none\n};\n\nvar CalendarDataService = function () {\n  function CalendarDataService(dateService) {\n    var _this = this;\n\n    _classCallCheck(this, CalendarDataService);\n\n    this.dateService = dateService;\n\n    this.createDayPickerData = function (date, dateRange) {\n      var weeks = _this.createDates(date, DEFAULT_DATE_OPTIONS, dateRange);\n\n      return _this.withBoundingMonths(weeks, date);\n    };\n\n    this.createMonthPickerData = function (date, rows, columns) {\n      var yearStart = _this.dateService.getYearStart(date);\n\n      var monthRange = helpers_1.range(rows * columns, function (index) {\n        var monthDate = _this.dateService.addMonth(yearStart, index);\n\n        return _extends({\n          date: monthDate\n        }, DEFAULT_DATE_OPTIONS);\n      });\n      return helpers_1.batch(monthRange, rows);\n    };\n\n    this.createYearPickerData = function (date, rows, columns) {\n      var yearStart = _this.dateService.getYearStart(date);\n\n      var yearRange = helpers_1.range(rows * columns, function (index) {\n        var yearDate = _this.dateService.addYear(yearStart, index);\n\n        return _extends({\n          date: yearDate\n        }, DEFAULT_DATE_OPTIONS);\n      });\n      return helpers_1.batch(yearRange, rows);\n    };\n\n    this.createDayPickerPagerData = function (startDate, endDate) {\n      var numberOfDayPickers = _this.getNumberOfMonths(startDate, endDate) + 1;\n      return helpers_1.range(numberOfDayPickers, function (index) {\n        var monthDate = _this.dateService.addMonth(startDate, index);\n\n        return _extends({\n          date: monthDate\n        }, DEFAULT_DATE_OPTIONS);\n      });\n    };\n\n    this.createYearPickerPagerData = function (startDate, endDate, rows, columns) {\n      var numberOfYears = _this.getNumberOfYears(startDate, endDate) + 1;\n      var numberOfYearPickers = Math.max(Math.ceil(numberOfYears / (rows * columns)), 1);\n      return helpers_1.range(numberOfYearPickers, function (index) {\n        var yearDate = _this.dateService.addYear(startDate, index * rows * columns);\n\n        return _extends({\n          date: yearDate\n        }, DEFAULT_DATE_OPTIONS);\n      });\n    };\n\n    this.getNumberOfMonths = function (lhs, rhs) {\n      var numberOfYears = _this.getNumberOfYears(lhs, rhs);\n\n      var numberOfMonths = _this.dateService.getMonth(rhs) - _this.dateService.getMonth(lhs);\n\n      return numberOfMonths + numberOfYears * date_service_1.DateService.MONTHS_IN_YEAR;\n    };\n\n    this.getNumberOfYears = function (lhs, rhs) {\n      return _this.dateService.getYear(rhs) - _this.dateService.getYear(lhs);\n    };\n  }\n\n  _createClass(CalendarDataService, [{\n    key: \"createDates\",\n    value: function createDates(activeMonth, options, dateRange) {\n      var days = this.createDateRangeForMonth(activeMonth, options);\n\n      if (dateRange) {\n        days = this.withRangedDates(days, dateRange);\n      }\n\n      var startOfWeekDayDiff = this.getStartOfWeekDayDiff(activeMonth);\n      return helpers_1.batch(days, date_service_1.DateService.DAYS_IN_WEEK, startOfWeekDayDiff);\n    }\n  }, {\n    key: \"withRangedDates\",\n    value: function withRangedDates(days, calendarRange) {\n      if (calendarRange.startDate && !calendarRange.endDate) {\n        return this.withRangedStartDates(days, calendarRange.startDate);\n      }\n\n      if (calendarRange.startDate && calendarRange.endDate) {\n        return this.withRangedStartEndDates(days, calendarRange.startDate, calendarRange.endDate);\n      }\n\n      return days;\n    }\n  }, {\n    key: \"withRangedStartDates\",\n    value: function withRangedStartDates(days, startDate) {\n      var _this2 = this;\n\n      return days.map(function (day) {\n        var isSameStartDate = _this2.dateService.compareDatesSafe(day.date, startDate) === 0;\n        return isSameStartDate ? _extends({}, day, {\n          range: type_1.RangeRole.start\n        }) : day;\n      });\n    }\n  }, {\n    key: \"withRangedStartEndDates\",\n    value: function withRangedStartEndDates(days, startDate, endDate) {\n      var _this3 = this;\n\n      return days.map(function (day) {\n        var isSameStartDate = _this3.dateService.compareDatesSafe(day.date, startDate) === 0;\n        var isSameEndDate = _this3.dateService.compareDatesSafe(day.date, endDate) === 0;\n\n        var isInRange = _this3.dateService.isBetween(day.date, startDate, endDate);\n\n        var rangeRole = type_1.RangeRole.none;\n\n        if (isInRange) {\n          rangeRole = type_1.RangeRole.member;\n        } else {\n          if (isSameStartDate) {\n            rangeRole |= type_1.RangeRole.start;\n          }\n\n          if (isSameEndDate) {\n            rangeRole |= type_1.RangeRole.end;\n          }\n        }\n\n        return _extends({}, day, {\n          range: rangeRole\n        });\n      });\n    }\n  }, {\n    key: \"withBoundingMonths\",\n    value: function withBoundingMonths(weeks, activeMonth) {\n      var withBoundingMonths = weeks;\n\n      if (this.isShouldAddPrevBoundingMonth(withBoundingMonths)) {\n        withBoundingMonths = this.addPrevBoundingMonth(withBoundingMonths, activeMonth);\n      }\n\n      if (this.isShouldAddNextBoundingMonth(withBoundingMonths)) {\n        withBoundingMonths = this.addNextBoundingMonth(withBoundingMonths, activeMonth);\n      }\n\n      return withBoundingMonths;\n    }\n  }, {\n    key: \"addPrevBoundingMonth\",\n    value: function addPrevBoundingMonth(weeks, activeMonth) {\n      var firstWeek = weeks.shift();\n      var numberOfBoundingDates = date_service_1.DateService.DAYS_IN_WEEK - firstWeek.length;\n      firstWeek.unshift.apply(firstWeek, _toConsumableArray(this.createPrevBoundingDays(activeMonth, numberOfBoundingDates)));\n      return [firstWeek].concat(_toConsumableArray(weeks));\n    }\n  }, {\n    key: \"addNextBoundingMonth\",\n    value: function addNextBoundingMonth(weeks, activeMonth) {\n      var lastWeek = weeks.pop();\n      var numberOfBoundingDates = date_service_1.DateService.DAYS_IN_WEEK - lastWeek.length;\n      lastWeek.push.apply(lastWeek, _toConsumableArray(this.createNextBoundingDays(activeMonth, numberOfBoundingDates)));\n      return [].concat(_toConsumableArray(weeks), [lastWeek]);\n    }\n  }, {\n    key: \"createPrevBoundingDays\",\n    value: function createPrevBoundingDays(activeMonth, numberOfBoundingDates) {\n      var month = this.dateService.addMonth(activeMonth, -1);\n      var daysInMonth = this.dateService.getNumberOfDaysInMonth(month);\n      return this.createDateRangeForMonth(month, DEFAULT_DATE_OPTIONS).slice(daysInMonth - numberOfBoundingDates).map(function (date) {\n        return _extends({}, date, {\n          bounding: true\n        });\n      });\n    }\n  }, {\n    key: \"createNextBoundingDays\",\n    value: function createNextBoundingDays(activeMonth, numberOfBoundingDates) {\n      var month = this.dateService.addMonth(activeMonth, 1);\n      return this.createDateRangeForMonth(month, DEFAULT_DATE_OPTIONS).slice(0, numberOfBoundingDates).map(function (date) {\n        return _extends({}, date, {\n          bounding: true\n        });\n      });\n    }\n  }, {\n    key: \"getStartOfWeekDayDiff\",\n    value: function getStartOfWeekDayDiff(date) {\n      var startOfMonth = this.dateService.getMonthStart(date);\n      return this.getWeekStartDiff(startOfMonth);\n    }\n  }, {\n    key: \"getWeekStartDiff\",\n    value: function getWeekStartDiff(date) {\n      return (date_service_1.DateService.DAYS_IN_WEEK - this.dateService.getFirstDayOfWeek() + this.dateService.getDayOfWeek(date)) % date_service_1.DateService.DAYS_IN_WEEK;\n    }\n  }, {\n    key: \"isShouldAddPrevBoundingMonth\",\n    value: function isShouldAddPrevBoundingMonth(weeks) {\n      return weeks[0].length < date_service_1.DateService.DAYS_IN_WEEK;\n    }\n  }, {\n    key: \"isShouldAddNextBoundingMonth\",\n    value: function isShouldAddNextBoundingMonth(weeks) {\n      return weeks[weeks.length - 1].length < date_service_1.DateService.DAYS_IN_WEEK;\n    }\n  }, {\n    key: \"createDateRangeForMonth\",\n    value: function createDateRangeForMonth(monthDate, options) {\n      var _this4 = this;\n\n      var daysInMonth = this.dateService.getNumberOfDaysInMonth(monthDate);\n      return helpers_1.range(daysInMonth, function (i) {\n        var year = _this4.dateService.getYear(monthDate);\n\n        var month = _this4.dateService.getMonth(monthDate);\n\n        var date = _this4.dateService.createDate(year, month, i + 1);\n\n        return _extends({\n          date: date\n        }, options);\n      });\n    }\n  }]);\n\n  return CalendarDataService;\n}();\n\nexports.CalendarDataService = CalendarDataService;","map":{"version":3,"sources":["../../../../../../src/components/ui/calendar/service/calendarData.service.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\n/**\n * @license\n * Copyright Akveo. All Rights Reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst date_service_1 = require(\"./date.service\");\nconst helpers_1 = require(\"./helpers\");\nconst type_1 = require(\"../type\");\nconst DEFAULT_DATE_OPTIONS = {\n    bounding: false,\n    holiday: false,\n    range: type_1.RangeRole.none,\n};\nclass CalendarDataService {\n    constructor(dateService) {\n        this.dateService = dateService;\n        this.createDayPickerData = (date, dateRange) => {\n            const weeks = this.createDates(date, DEFAULT_DATE_OPTIONS, dateRange);\n            return this.withBoundingMonths(weeks, date);\n        };\n        this.createMonthPickerData = (date, rows, columns) => {\n            const yearStart = this.dateService.getYearStart(date);\n            const monthRange = helpers_1.range(rows * columns, (index) => {\n                const monthDate = this.dateService.addMonth(yearStart, index);\n                return { date: monthDate, ...DEFAULT_DATE_OPTIONS };\n            });\n            return helpers_1.batch(monthRange, rows);\n        };\n        this.createYearPickerData = (date, rows, columns) => {\n            const yearStart = this.dateService.getYearStart(date);\n            const yearRange = helpers_1.range(rows * columns, (index) => {\n                const yearDate = this.dateService.addYear(yearStart, index);\n                return { date: yearDate, ...DEFAULT_DATE_OPTIONS };\n            });\n            return helpers_1.batch(yearRange, rows);\n        };\n        this.createDayPickerPagerData = (startDate, endDate) => {\n            const numberOfDayPickers = this.getNumberOfMonths(startDate, endDate) + 1;\n            return helpers_1.range(numberOfDayPickers, (index) => {\n                const monthDate = this.dateService.addMonth(startDate, index);\n                return { date: monthDate, ...DEFAULT_DATE_OPTIONS };\n            });\n        };\n        this.createYearPickerPagerData = (startDate, endDate, rows, columns) => {\n            const numberOfYears = this.getNumberOfYears(startDate, endDate) + 1;\n            const numberOfYearPickers = Math.max(Math.ceil(numberOfYears / (rows * columns)), 1);\n            return helpers_1.range(numberOfYearPickers, (index) => {\n                const yearDate = this.dateService.addYear(startDate, index * rows * columns);\n                return { date: yearDate, ...DEFAULT_DATE_OPTIONS };\n            });\n        };\n        this.getNumberOfMonths = (lhs, rhs) => {\n            const numberOfYears = this.getNumberOfYears(lhs, rhs);\n            const numberOfMonths = this.dateService.getMonth(rhs) - this.dateService.getMonth(lhs);\n            return numberOfMonths + numberOfYears * date_service_1.DateService.MONTHS_IN_YEAR;\n        };\n        this.getNumberOfYears = (lhs, rhs) => {\n            return this.dateService.getYear(rhs) - this.dateService.getYear(lhs);\n        };\n    }\n    createDates(activeMonth, options, dateRange) {\n        let days = this.createDateRangeForMonth(activeMonth, options);\n        if (dateRange) {\n            days = this.withRangedDates(days, dateRange);\n        }\n        const startOfWeekDayDiff = this.getStartOfWeekDayDiff(activeMonth);\n        return helpers_1.batch(days, date_service_1.DateService.DAYS_IN_WEEK, startOfWeekDayDiff);\n    }\n    withRangedDates(days, calendarRange) {\n        if (calendarRange.startDate && !calendarRange.endDate) {\n            return this.withRangedStartDates(days, calendarRange.startDate);\n        }\n        if (calendarRange.startDate && calendarRange.endDate) {\n            return this.withRangedStartEndDates(days, calendarRange.startDate, calendarRange.endDate);\n        }\n        return days;\n    }\n    withRangedStartDates(days, startDate) {\n        return days.map((day) => {\n            const isSameStartDate = this.dateService.compareDatesSafe(day.date, startDate) === 0;\n            return isSameStartDate ? { ...day, range: type_1.RangeRole.start } : day;\n        });\n    }\n    withRangedStartEndDates(days, startDate, endDate) {\n        return days.map((day) => {\n            const isSameStartDate = this.dateService.compareDatesSafe(day.date, startDate) === 0;\n            const isSameEndDate = this.dateService.compareDatesSafe(day.date, endDate) === 0;\n            const isInRange = this.dateService.isBetween(day.date, startDate, endDate);\n            let rangeRole = type_1.RangeRole.none;\n            if (isInRange) {\n                rangeRole = type_1.RangeRole.member;\n            }\n            else {\n                if (isSameStartDate) {\n                    rangeRole |= type_1.RangeRole.start;\n                }\n                if (isSameEndDate) {\n                    rangeRole |= type_1.RangeRole.end;\n                }\n            }\n            return { ...day, range: rangeRole };\n        });\n    }\n    withBoundingMonths(weeks, activeMonth) {\n        let withBoundingMonths = weeks;\n        if (this.isShouldAddPrevBoundingMonth(withBoundingMonths)) {\n            withBoundingMonths = this.addPrevBoundingMonth(withBoundingMonths, activeMonth);\n        }\n        if (this.isShouldAddNextBoundingMonth(withBoundingMonths)) {\n            withBoundingMonths = this.addNextBoundingMonth(withBoundingMonths, activeMonth);\n        }\n        return withBoundingMonths;\n    }\n    addPrevBoundingMonth(weeks, activeMonth) {\n        const firstWeek = weeks.shift();\n        const numberOfBoundingDates = date_service_1.DateService.DAYS_IN_WEEK - firstWeek.length;\n        firstWeek.unshift(...this.createPrevBoundingDays(activeMonth, numberOfBoundingDates));\n        return [firstWeek, ...weeks];\n    }\n    addNextBoundingMonth(weeks, activeMonth) {\n        const lastWeek = weeks.pop();\n        const numberOfBoundingDates = date_service_1.DateService.DAYS_IN_WEEK - lastWeek.length;\n        lastWeek.push(...this.createNextBoundingDays(activeMonth, numberOfBoundingDates));\n        return [...weeks, lastWeek];\n    }\n    createPrevBoundingDays(activeMonth, numberOfBoundingDates) {\n        const month = this.dateService.addMonth(activeMonth, -1);\n        const daysInMonth = this.dateService.getNumberOfDaysInMonth(month);\n        return this.createDateRangeForMonth(month, DEFAULT_DATE_OPTIONS)\n            .slice(daysInMonth - numberOfBoundingDates)\n            .map((date) => {\n            return { ...date, bounding: true };\n        });\n    }\n    createNextBoundingDays(activeMonth, numberOfBoundingDates) {\n        const month = this.dateService.addMonth(activeMonth, 1);\n        return this.createDateRangeForMonth(month, DEFAULT_DATE_OPTIONS)\n            .slice(0, numberOfBoundingDates)\n            .map((date) => {\n            return { ...date, bounding: true };\n        });\n    }\n    getStartOfWeekDayDiff(date) {\n        const startOfMonth = this.dateService.getMonthStart(date);\n        return this.getWeekStartDiff(startOfMonth);\n    }\n    getWeekStartDiff(date) {\n        return (date_service_1.DateService.DAYS_IN_WEEK\n            - this.dateService.getFirstDayOfWeek()\n            + this.dateService.getDayOfWeek(date)) % date_service_1.DateService.DAYS_IN_WEEK;\n    }\n    isShouldAddPrevBoundingMonth(weeks) {\n        return weeks[0].length < date_service_1.DateService.DAYS_IN_WEEK;\n    }\n    isShouldAddNextBoundingMonth(weeks) {\n        return weeks[weeks.length - 1].length < date_service_1.DateService.DAYS_IN_WEEK;\n    }\n    createDateRangeForMonth(monthDate, options) {\n        const daysInMonth = this.dateService.getNumberOfDaysInMonth(monthDate);\n        return helpers_1.range(daysInMonth, (i) => {\n            const year = this.dateService.getYear(monthDate);\n            const month = this.dateService.getMonth(monthDate);\n            const date = this.dateService.createDate(year, month, i + 1);\n            return { date, ...options };\n        });\n    }\n}\nexports.CalendarDataService = CalendarDataService;\n//# sourceMappingURL=calendarData.service.js.map"]},"metadata":{},"sourceType":"script"}